# Save Slides Feature - Visual Guide

## ğŸ¯ Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Normal Mode                              â”‚
â”‚  URL: /template/[id]                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Slide 1  â”‚  Slide 2  â”‚  Slide 3  â”‚  Slide 4  â”‚ ... â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  [No Save Button]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Save Mode                                â”‚
â”‚  URL: /template/[id]?format=save                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Slide 1  â”‚  Slide 2  â”‚  Slide 3  â”‚  Slide 4  â”‚ ... â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ’¾ Save All Slides to Cloud                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Process Flow

### Step 1: User Access

```
User enters URL with ?format=save parameter
                â†“
        Page renders normally
                â†“
    SaveSlidesButton appears at bottom
```

### Step 2: Capture Process

```
User clicks "Save All Slides to Cloud"
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each slide (0 to totalSlides-1): â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Find element by data-slide-index  â”‚
â”‚ 2. html2canvas(element)               â”‚
â”‚ 3. canvas.toDataURL("image/png")     â”‚
â”‚ 4. Store in array                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
    Progress: 0% â†’ 50% (Capturing)
```

### Step 3: Upload Process

```
POST /api/riddles/save-slides
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each captured image:              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Extract base64 from dataURL       â”‚
â”‚ 2. imagekit.upload(base64)           â”‚
â”‚ 3. Get secure URL                     â”‚
â”‚ 4. Update slide.saved_image_url       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
    Progress: 50% â†’ 100% (Uploading)
                â†“
        Save to MongoDB
                â†“
    Return success/failure results
```

### Step 4: Completion

```
Client receives response
                â†“
    Show success message
                â†“
    Wait 2 seconds
                â†“
    window.location.reload()
```

## ğŸ“Š Data Structure

### Client-Side (SaveSlidesButton)

```typescript
// State Management
const [loading, setLoading] = useState(false);
const [progress, setProgress] = useState(0); // 0-100
const [status, setStatus] = useState("");

// Captured Images Array
const capturedImages: Array<{
    slideIndex: number;
    dataUrl: string; // "data:image/png;base64,..."
}>;
```

### API Request Format

```json
{
    "riddleId": "507f1f77bcf86cd799439011",
    "images": [
        {
            "slideIndex": 0,
            "dataUrl": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
        },
        {
            "slideIndex": 1,
            "dataUrl": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
        }
    ]
}
```

### API Response Format

```json
{
    "success": true,
    "message": "Successfully saved 5 out of 5 slides",
    "data": {
        "riddleId": "507f1f77bcf86cd799439011",
        "uploadResults": [
            {
                "slideIndex": 0,
                "imageUrl": "https://ik.imagekit.io/.../slide-0.png",
                "success": true
            },
            {
                "slideIndex": 1,
                "imageUrl": "https://ik.imagekit.io/.../slide-1.png",
                "success": true
            }
        ],
        "successCount": 5,
        "totalCount": 5
    }
}
```

### Database Schema

```javascript
// Before save
{
  "_id": ObjectId("507f1f77bcf86cd799439011"),
  "title": "Programming Riddle",
  "carouselData": {
    "slides": [
      {
        "tipe_slide": "COVER",
        "judul_slide": "Test Your Skills",
        "sub_judul_slide": "Programming Challenge",
        "konten_slide": "Content here...",
        "prompt_untuk_image": "A computer coding...",
        // saved_image_url: undefined (not exists)
      }
    ]
  }
}

// After save
{
  "_id": ObjectId("507f1f77bcf86cd799439011"),
  "title": "Programming Riddle",
  "carouselData": {
    "slides": [
      {
        "tipe_slide": "COVER",
        "judul_slide": "Test Your Skills",
        "sub_judul_slide": "Programming Challenge",
        "konten_slide": "Content here...",
        "prompt_untuk_image": "A computer coding...",
        "saved_image_url": "https://ik.imagekit.io/xyz/riddles/507f1f77bcf86cd799439011/riddle-507f1f77bcf86cd799439011-slide-0-1698765432100.png" // âœ… NEW
      }
    ]
  }
}
```

## ğŸ¨ UI Components

### SaveSlidesButton Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                  â”‚
â”‚  Progress: Capturing slide 3 of 5...       60%  â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  â³ Processing...                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                  â”‚
â”‚  Akan menyimpan 5 slides sebagai gambar ke      â”‚
â”‚  cloud storage                                   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### States

```
Initial State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ Save All Slides to Cloud         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Loading State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â³ Processing...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Success State:
Status: "âœ… Semua slide berhasil disimpan!"
Progress: 100%
[Auto-refresh in 2 seconds]

Error State:
Status: "âŒ Terjadi kesalahan: Error message here"
```

## ğŸ”§ Configuration Files

### .env.local (Required)

```env
# ImageKit (Default)
NEXT_PUBLIC_IMAGEKIT_PUBLIC_KEY=public_xxx
IMAGEKIT_PRIVATE_KEY=private_xxx
NEXT_PUBLIC_IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/your_id

# OR Cloudinary (Alternative)
# CLOUDINARY_CLOUD_NAME=your_cloud
# CLOUDINARY_API_KEY=123456789
# CLOUDINARY_API_SECRET=xxxxxxxxxxxxx
```

### package.json (Dependencies)

```json
{
    "dependencies": {
        "html2canvas": "^1.4.1",
        "imagekit": "^6.0.0"
    }
}
```

### Optional (Cloudinary)

```bash
npm install cloudinary
```

## ğŸ“ File Structure

```
project/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SaveSlidesButton.tsx          # Client component
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (template-post)/
â”‚   â”‚   â””â”€â”€ template/
â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚           â””â”€â”€ page.tsx           # Updated with ?format=save
â”‚   â”‚
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ riddles/
â”‚           â”œâ”€â”€ save-slides/
â”‚           â”‚   â””â”€â”€ route.ts           # ImageKit endpoint
â”‚           â””â”€â”€ save-slides-cloudinary/
â”‚               â””â”€â”€ route.ts           # Cloudinary endpoint (optional)
â”‚
â”œâ”€â”€ .env.example                       # Environment template
â”œâ”€â”€ .env.local                         # Your credentials (gitignored)
â”‚
â”œâ”€â”€ SAVE_SLIDES_QUICKSTART.md         # Quick start guide
â”œâ”€â”€ SAVE_SLIDES_FEATURE.md            # Full documentation
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md          # Technical summary
â””â”€â”€ SAVE_SLIDES_VISUAL_GUIDE.md       # This file
```

## ğŸ” Security Flow

```
Client Request
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Authentication?     â”‚  â† Not implemented yet
â”‚ (TODO)              â”‚     Recommended to add
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rate Limiting?      â”‚  â† Not implemented yet
â”‚ (TODO)              â”‚     Recommended to add
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate Input      â”‚  âœ… Implemented
â”‚ - riddleId valid?   â”‚
â”‚ - images array?     â”‚
â”‚ - slideIndex valid? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Riddle Exists â”‚  âœ… Implemented
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload to Cloud     â”‚  âœ… Implemented
â”‚ - ImageKit/         â”‚
â”‚   Cloudinary        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Database     â”‚  âœ… Implemented
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
   Response
```

## ğŸ“ˆ Performance Metrics

### Expected Times (approximate)

```
Per Slide:
â”œâ”€â”€ Capture (html2canvas): ~200-500ms
â”œâ”€â”€ Base64 conversion: ~50-100ms
â””â”€â”€ Upload to cloud: ~500-2000ms (depends on size & connection)

Total for 5 slides:
â”œâ”€â”€ Capture phase: ~1-2.5 seconds
â”œâ”€â”€ Upload phase: ~2.5-10 seconds
â””â”€â”€ Database save: ~200-500ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL: ~4-13 seconds
```

### Optimization Strategies

```
Current: Sequential Processing
Slide 1 â†’ Slide 2 â†’ Slide 3 â†’ Slide 4 â†’ Slide 5
[â•â•â•â•â•][â•â•â•â•â•][â•â•â•â•â•][â•â•â•â•â•][â•â•â•â•â•]

Alternative: Parallel Upload
Slide 1 â”
Slide 2 â”œâ”€â†’ Upload simultaneously
Slide 3 â”œâ”€â†’ (after all captured)
Slide 4 â”œâ”€â†’
Slide 5 â”˜
[â•â•â•â•â•]
  â””â”€â†’ 2-5x faster upload phase
```

## ğŸ“ Usage Examples

### Example 1: Test with Single Riddle

```bash
# 1. Start dev server
npm run dev

# 2. Open browser
http://localhost:3000/template/6735a1b2c3d4e5f6a7b8c9d0?format=save

# 3. Click button and wait

# 4. Check ImageKit dashboard
https://imagekit.io/dashboard/media-library
```

### Example 2: Verify Saved URLs

```javascript
// In MongoDB or API
db.riddles.findOne({ _id: ObjectId("6735a1b2c3d4e5f6a7b8c9d0") });

// Check output:
{
    carouselData: {
        slides: [
            {
                // ... other fields
                saved_image_url: "https://ik.imagekit.io/...", // âœ… Should exist
            },
        ];
    }
}
```

### Example 3: Use Saved Images

```tsx
// In your component
<img
    src={slide.saved_image_url || slide.prompt_untuk_image}
    alt={slide.judul_slide}
/>

// Priority: saved_image_url > prompt_untuk_image
```

## ğŸ› Debugging Tips

### Client-Side Debugging

```javascript
// In browser console
console.log("Slide wrappers:", document.querySelectorAll("[data-slide-index]"));
console.log("First slide:", document.querySelector('[data-slide-index="0"]'));
```

### Server-Side Debugging

```typescript
// In API route
console.log("Received images count:", images.length);
console.log("Upload result:", uploadResponse);
console.log("Database update:", riddle.carouselData.slides[0].saved_image_url);
```

### Network Debugging

```
Chrome DevTools â†’ Network Tab
â”œâ”€â”€ Filter: Fetch/XHR
â”œâ”€â”€ Look for: "save-slides"
â”œâ”€â”€ Check: Request payload
â”œâ”€â”€ Check: Response
â””â”€â”€ Check: Status code
```

## ğŸ‰ Success Indicators

âœ… Button appears when ?format=save is in URL
âœ… Progress bar shows 0-100%
âœ… Status text updates during process
âœ… Success message appears
âœ… Page auto-refreshes
âœ… Images visible in ImageKit dashboard
âœ… saved_image_url populated in database
âœ… No console errors

---

Made with â¤ï¸ for ByteUnite
